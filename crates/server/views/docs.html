{% extends "base.html" %}

{% block title %}{{ project_name }} Template Documentation{% endblock %}
{% block description %}Template docs for {{ project_name }}: CRUD router setup, filter syntax, and where to extend the stack.{% endblock %}

{% block content %}
      <main class="px-6 pb-16 pt-10 sm:px-10">
        <section class="fade-1 mx-auto max-w-3xl space-y-6">
          <div
            class="inline-flex items-center gap-3 rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs uppercase tracking-[0.3em] text-black/60 shadow-sm"
          >
            <span class="h-2 w-2 rounded-full bg-[color:var(--clay)]"></span>
            {{ project_name }} docs
          </div>
          <h1 class="font-display text-4xl leading-tight text-[color:var(--pine)] sm:text-5xl">
            {{ project_name }} Template Documentation
          </h1>
          <p class="text-base text-black/70 sm:text-lg">
            Use this page as your quick reference for wiring CRUD APIs, tuning
            filters, and knowing where to extend the core building blocks.
          </p>
          <div class="flex flex-wrap items-center gap-3 text-xs">
            <a
              class="rounded-full border border-black/10 bg-white/80 px-4 py-2 font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] transition hover:-translate-y-0.5"
              href="#getting-started"
            >
              Getting started
            </a>
            <a
              class="rounded-full border border-black/10 bg-white/80 px-4 py-2 font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] transition hover:-translate-y-0.5"
              href="#cli"
            >
              CLI
            </a>
            <a
              class="rounded-full border border-black/10 bg-white/80 px-4 py-2 font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] transition hover:-translate-y-0.5"
              href="#config"
            >
              Config
            </a>
            <a
              class="rounded-full border border-black/10 bg-white/80 px-4 py-2 font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] transition hover:-translate-y-0.5"
              href="#crud-router"
            >
              CRUD router
            </a>
            <a
              class="rounded-full border border-black/10 bg-white/80 px-4 py-2 font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] transition hover:-translate-y-0.5"
              href="#filters"
            >
              Filters
            </a>
          </div>
        </section>

        <section id="getting-started" class="fade-2 mx-auto mt-14 max-w-3xl space-y-4">
          <p class="inline-flex items-center gap-2 text-lg font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] sm:text-xl">
            <span class="h-2.5 w-2.5 rounded-full bg-[color:var(--clay)]"></span>
            Getting started
          </p>
          <h2 class="font-display text-2xl leading-tight text-[color:var(--pine)] sm:text-3xl">From entity to API in four steps.</h2>
          <p class="text-sm text-black/70">
            The minimum path is: define your SeaORM entity, add a DAO, implement a service,
            then mount a CRUD router. Each layer stays focused so you can iterate quickly.
          </p>
          <div class="rounded-2xl border border-black/10 bg-white/90 p-4 text-sm text-black/70">
            <ol class="list-decimal list-inside space-y-1">
              <li>Define entity in <span class="font-semibold">src/db/entities/</span></li>
              <li>Add DAO in <span class="font-semibold">src/db/dao/</span></li>
              <li>Implement <span class="font-semibold">CrudService</span> in <span class="font-semibold">src/services/</span></li>
              <li>Mount <span class="font-semibold">CrudApiRouter</span> in <span class="font-semibold">src/routes/</span></li>
            </ol>
          </div>
          <div class="rounded-2xl border border-black/10 bg-white/90 p-4 text-xs text-black/70">
            <p class="font-semibold text-[color:var(--pine)]">Step 1: Entity</p>
            <pre class="mt-3 overflow-x-auto rounded-xl bg-[color:var(--mist)] p-3 text-xs text-[color:var(--pine)]"><code>// src/db/entities/todo_list.rs
use base_entity_derive::base_entity;
use sea_orm::entity::prelude::*;

#[base_entity]
#[sea_orm::model]
#[derive(Clone, Debug, PartialEq, Eq, serde::Serialize, serde::Deserialize, DeriveEntityModel)]
#[sea_orm(table_name = "todo_lists")]
pub struct Model {
    pub title: String,
    #[sea_orm(default_value = 0)]
    pub score: i32,
    #[sea_orm(has_many)]
    pub items: HasMany<super::todo_item::Entity>,
}

impl ActiveModelBehavior for ActiveModel {}</code></pre>
          </div>
          <div class="rounded-2xl border border-black/10 bg-white/90 p-4 text-xs text-black/70">
            <p class="font-semibold text-[color:var(--pine)]">Step 2: DAO</p>
            <pre class="mt-3 overflow-x-auto rounded-xl bg-[color:var(--mist)] p-3 text-xs text-[color:var(--pine)]"><code>// src/db/dao/todo_dao.rs
use sea_orm::DatabaseConnection;
use crate::db::dao::DaoBase;
use crate::db::entities::prelude::TodoList;

#[derive(Clone)]
pub struct TodoDao {
    db: DatabaseConnection,
}

impl DaoBase for TodoDao {
    type Entity = TodoList;

    fn from_db(db: DatabaseConnection) -> Self {
        Self { db }
    }

    fn db(&self) -> &DatabaseConnection {
        &self.db
    }
}</code></pre>
          </div>
          <div class="rounded-2xl border border-black/10 bg-white/90 p-4 text-xs text-black/70">
            <p class="font-semibold text-[color:var(--pine)]">Step 3: Service</p>
            <pre class="mt-3 overflow-x-auto rounded-xl bg-[color:var(--mist)] p-3 text-xs text-[color:var(--pine)]"><code>// src/services/todo_service.rs
use crate::db::dao::TodoDao;
use crate::services::crud_service::CrudService;

#[derive(Clone)]
pub struct TodoService {
    todo_dao: TodoDao,
}

impl TodoService {
    pub fn new(todo_dao: TodoDao) -> Self {
        Self { todo_dao }
    }
}

impl CrudService for TodoService {
    type Dao = TodoDao;

    fn dao(&self) -> &Self::Dao {
        &self.todo_dao
    }
}</code></pre>
          </div>
          <div class="rounded-2xl border border-black/10 bg-white/90 p-4 text-xs text-black/70">
            <p class="font-semibold text-[color:var(--pine)]">Step 4: Router</p>
            <pre class="mt-3 overflow-x-auto rounded-xl bg-[color:var(--mist)] p-3 text-xs text-[color:var(--pine)]"><code>// src/routes/todo_crud.rs
use std::sync::Arc;
use axum::Router;
use crate::db::dao::DaoContext;
use crate::routes::base_api_router::CrudApiRouter;
use crate::services::todo_service::TodoService;
use crate::state::AppState;

const BASE_PATH: &str = "/todo-crud";

pub fn router(state: Arc<AppState>) -> Router {
    let daos = DaoContext::new(&state.db);
    let service = TodoService::new(daos.todo());
    CrudApiRouter::new(service, BASE_PATH).router().with_state(state)
}</code></pre>
          </div>
        </section>

        <section id="project-structure" class="fade-2 mx-auto mt-14 max-w-3xl space-y-4">
          <p class="inline-flex items-center gap-2 text-lg font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] sm:text-xl">
            <span class="h-2.5 w-2.5 rounded-full bg-[color:var(--clay)]"></span>
            Project structure
          </p>
          <h2 class="font-display text-2xl leading-tight text-[color:var(--pine)] sm:text-3xl">Know where to look first.</h2>
          <p class="text-sm text-black/70">
            This tree highlights the core modules you will touch most when extending the template.
          </p>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <pre class="overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code># repo root (key modules)
src/
  main.rs                 # bootstraps config, state, logging, router
  config.rs               # env-driven settings
  state.rs                # shared AppState (config, jwt keys, db)
  routes/                 # API + HTML routes
    base_api_router.rs    # CRUD router builder
    public.rs             # landing + docs + routes views
    auth.rs               # register/login/refresh
    protected.rs          # /me route
    admin.rs              # /admin stats
  services/               # business logic layer
    crud_service.rs       # filter parsing + list helpers
  db/
    entities/             # SeaORM entities (schema)
    dao/                  # data access objects
views/
  base.html               # shared layout
  docs.html               # docs page</code></pre>
          </div>
        </section>

        <section id="auth" class="fade-2 mx-auto mt-14 max-w-3xl space-y-4">
          <p class="inline-flex items-center gap-2 text-lg font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] sm:text-xl">
            <span class="h-2.5 w-2.5 rounded-full bg-[color:var(--clay)]"></span>
            JWT auth
          </p>
          <h2 class="font-display text-2xl leading-tight text-[color:var(--pine)] sm:text-3xl">Register, get a token, protect routes.</h2>
          <p class="text-sm text-black/70">
            The auth router provides <span class="font-semibold">/register</span>,
            <span class="font-semibold">/login</span>, and <span class="font-semibold">/refresh</span>.
            Use the access token as a Bearer token to call protected endpoints.
          </p>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Get tokens</p>
            <div
              class="mt-4 rounded-2xl border border-black/10 shadow-inner"
              data-terminal="true"
              style="background-color: var(--pine); color: var(--mist);"
            >
              <div class="flex items-center justify-between border-b border-white/10 px-4 py-2 text-[10px] uppercase tracking-[0.3em] text-white/70">
                <span>Terminal</span>
                <button
                  class="rounded-full border border-white/20 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-white/70 transition hover:border-white/40 hover:text-white"
                  data-copy-target="terminal-auth-tokens"
                  type="button"
                >
                  Copy
                </button>
              </div>
              <pre class="overflow-x-auto px-4 py-4 text-xs text-white"><code id="terminal-auth-tokens"># register
curl -X POST http://localhost:3000/register \\
  -H "Content-Type: application/json" \\
  -d '{"email":"you@example.com","password":"password123"}'

# login
curl -X POST http://localhost:3000/login \\
  -H "Content-Type: application/json" \\
  -d '{"email":"you@example.com","password":"password123"}'</code></pre>
            </div>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Call a protected route</p>
            <div
              class="mt-4 rounded-2xl border border-black/10 shadow-inner"
              data-terminal="true"
              style="background-color: var(--pine); color: var(--mist);"
            >
              <div class="flex items-center justify-between border-b border-white/10 px-4 py-2 text-[10px] uppercase tracking-[0.3em] text-white/70">
                <span>Terminal</span>
                <button
                  class="rounded-full border border-white/20 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-white/70 transition hover:border-white/40 hover:text-white"
                  data-copy-target="terminal-protected-route"
                  type="button"
                >
                  Copy
                </button>
              </div>
              <pre class="overflow-x-auto px-4 py-4 text-xs text-white"><code id="terminal-protected-route"># /me is protected
curl http://localhost:3000/me \\
  -H "Authorization: Bearer $ACCESS_TOKEN"</code></pre>
            </div>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Minimal route protection</p>
            <pre class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code>// src/routes/protected.rs
use axum::{Router, routing::get};
use std::sync::Arc;
use crate::middleware::AuthGuard;
use crate::state::AppState;

pub fn router(state: Arc<AppState>) -> Router {
    Router::new()
        .route("/me", get(me))
        .with_state(state)
}

async fn me(_auth: AuthGuard) {
    // ...
}</code></pre>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Role-based protection</p>
            <pre class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code>// src/routes/admin.rs
use axum::{Router, routing::get};
use std::sync::Arc;
use crate::middleware::{AdminRole, AuthRoleGuard};
use crate::state::AppState;

pub fn router(state: Arc<AppState>) -> Router {
    Router::new()
        .route("/admin/stats", get(admin_stats))
        .with_state(state)
}

async fn admin_stats(AuthRoleGuard { .. }: AuthRoleGuard<AdminRole>) {
    // ...
}</code></pre>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Role per route</p>
            <pre class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code>// src/routes/protected.rs
use axum::{Router, routing::get};
use std::sync::Arc;
use crate::middleware::{AdminRole, AuthRoleGuard, UserRole};
use crate::state::AppState;

pub fn router(state: Arc<AppState>) -> Router {
    Router::new()
        .route("/reports", get(reports))
        .route("/admin/stats", get(admin_stats))
        .with_state(state)
}

async fn reports(_auth: AuthRoleGuard<UserRole>) {
    // ...
}

async fn admin_stats(_auth: AuthRoleGuard<AdminRole>) {
    // ...
}</code></pre>
          </div>
        </section>

        <section id="config" class="fade-2 mx-auto mt-14 max-w-3xl space-y-4">
          <p class="inline-flex items-center gap-2 text-lg font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] sm:text-xl">
            <span class="h-2.5 w-2.5 rounded-full bg-[color:var(--clay)]"></span>
            Application config
          </p>
          <h2 class="font-display text-2xl leading-tight text-[color:var(--pine)] sm:text-3xl">Extend AppConfig, then use it anywhere.</h2>
          <p class="text-sm text-black/70">
            Configuration lives in <span class="font-semibold">src/config.rs</span> and is loaded once
            at startup. The config is stored on <span class="font-semibold">AppState</span>, so routes
            and services can access it via the shared state.
          </p>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Step 1: add a field</p>
            <pre class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code>// src/config.rs
#[derive(Debug, Clone)]
pub struct AppConfig {
    // ...
    pub app_name: String,
}

impl AppConfig {
    pub fn from_env() -> Result<Self> {
        // ...
        let app_name = std::env::var("APP_NAME")
            .unwrap_or_else(|_| "Sample Server".to_string());
        Ok(Self {
            // ...
            app_name,
        })
    }
}</code></pre>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Step 2: read in routes</p>
            <pre class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code>// src/routes/public.rs
use axum::extract::State;
use std::sync::Arc;
use crate::state::AppState;

async fn handler(State(state): State<Arc<AppState>>) {
    let name = &state.config.app_name;
    // use name in your response
}</code></pre>
          </div>
        </section>

        <section id="crud-router" class="fade-2 mx-auto mt-14 max-w-3xl space-y-4">
          <p class="inline-flex items-center gap-2 text-lg font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] sm:text-xl">
            <span class="h-2.5 w-2.5 rounded-full bg-[color:var(--clay)]"></span>
            CRUD router
          </p>
          <h2 class="font-display text-2xl leading-tight text-[color:var(--pine)] sm:text-3xl">Wrap a service, expose CRUD JSON.</h2>
          <p class="text-sm text-black/70">
            The file <span class="font-semibold">src/routes/base_api_router.rs</span> provides
            <span class="font-semibold">CrudApiRouter</span>. Hand it a service that implements
            <span class="font-semibold">CrudService</span> and a base path, and you get five
            JSON endpoints by default.
          </p>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Quick setup</p>
            <pre
              class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"
            ><code>// src/routes/todo_crud.rs
use crate::db::dao::DaoContext;
use crate::routes::base_api_router::{CrudApiRouter, Method};
use crate::services::todo_service::TodoService;

let daos = DaoContext::new(&state.db);
let service = TodoService::new(daos.todo());
let router = CrudApiRouter::new(service, "/todo-crud")
    .set_allowed_methods(&[
        Method::Create,
        Method::List,
        Method::Get,
        Method::Patch,
        Method::Delete,
    ])
    .router();</code></pre>
            <p class="mt-4 text-sm text-black/60">
              Keep handlers thin. Customize list ordering and filtering through the service
              and override list hooks in the router if needed.
            </p>
          </div>
          <div class="rounded-2xl border border-black/10 bg-white/90 p-4 text-xs text-black/70">
            <p class="font-semibold text-[color:var(--pine)]">Default endpoints</p>
            <pre class="mt-3 overflow-x-auto rounded-xl bg-[color:var(--mist)] p-3 text-xs text-[color:var(--pine)]"><code># http
POST /base
GET /base
GET /base/{id}
PATCH /base/{id}
DELETE /base/{id}</code></pre>
            <p class="mt-2 text-black/50">IDs are UUIDs in this template.</p>
          </div>
          <div class="rounded-2xl border border-black/10 bg-[color:var(--mist)]/60 p-4 text-xs text-black/70">
            <p class="font-semibold text-[color:var(--pine)]">Pagination defaults</p>
            <pre class="mt-3 overflow-x-auto rounded-xl bg-white/80 p-3 text-xs text-[color:var(--pine)]"><code># query params
?page=1&page_size=25</code></pre>
            <p class="mt-2 text-black/50">Max page_size is 100.</p>
          </div>
          <div class="rounded-2xl border border-black/10 bg-white/90 p-4 text-xs text-black/70">
            <p class="font-semibold text-[color:var(--pine)]">Extension points</p>
            <pre class="mt-3 overflow-x-auto rounded-xl bg-[color:var(--mist)] p-3 text-xs text-[color:var(--pine)]"><code>// src/routes/your_router.rs
use axum::routing::{get, post};
use sea_orm::{ColumnTrait, Order, QueryFilter};
use crate::middleware::AuthGuard;
use crate::routes::base_api_router::{CrudApiRouter, Method, ListQuery};

async fn create_todo(_auth: AuthGuard) {
    // ...
}

let router = CrudApiRouter::new(service, "/todos")
    .set_allowed_methods(&[Method::Create, Method::List, Method::Get])
    .router()
    .route("/todos", post(create_todo))
    .route("/todos", get(list_todos));

fn list_order() -> Option<(Column, Order)> {
    Some((Column::CreatedAt, Order::Desc))
}

fn list_apply(query: &ListQuery, select: Select<Entity>) -> Select<Entity> {
    if let Some(owner_id) = query.filters.get("owner_id") {
        select.filter(Column::OwnerId.eq(owner_id.as_str()))
    } else {
        select
    }
}</code></pre>
          </div>
        </section>

        <section id="filters" class="fade-3 mx-auto mt-14 max-w-3xl space-y-4">
          <p class="inline-flex items-center gap-2 text-lg font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] sm:text-xl">
            <span class="h-2.5 w-2.5 rounded-full bg-[color:var(--clay)]"></span>
            Filters
          </p>
          <h3 class="font-display text-2xl leading-tight text-[color:var(--pine)] sm:text-3xl">Flexible filtering with clear syntax.</h3>
          <p class="text-sm text-black/70">
            List endpoints accept query params and can turn them into SQL filters.
            The default mode allows all columns and parses by column type. You can
            switch to an allowlist or deny specific columns in your service.
          </p>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Strings</p>
            <pre class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code># query
name=acme
name=acme*
name=*acme
name=*acme*</code></pre>
            <div
              class="mt-3 rounded-2xl border border-black/10 shadow-inner"
              data-terminal="true"
              style="background-color: var(--pine); color: var(--mist);"
            >
              <div class="flex items-center justify-between border-b border-white/10 px-4 py-2 text-[10px] uppercase tracking-[0.3em] text-white/70">
                <span>Terminal</span>
                <button
                  class="rounded-full border border-white/20 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-white/70 transition hover:border-white/40 hover:text-white"
                  data-copy-target="terminal-strings"
                  type="button"
                >
                  Copy
                </button>
              </div>
              <pre class="overflow-x-auto px-4 py-4 text-xs text-white"><code id="terminal-strings">curl -G http://localhost:3000/api/todos \\
  --data-urlencode "name=*acme*"</code></pre>
            </div>
            <p class="mt-2 text-xs text-black/50">Wildcards are only allowed at the ends.</p>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Numbers</p>
            <pre class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code># query
count=>=10
count<10
count=10..25</code></pre>
            <div
              class="mt-3 rounded-2xl border border-black/10 shadow-inner"
              data-terminal="true"
              style="background-color: var(--pine); color: var(--mist);"
            >
              <div class="flex items-center justify-between border-b border-white/10 px-4 py-2 text-[10px] uppercase tracking-[0.3em] text-white/70">
                <span>Terminal</span>
                <button
                  class="rounded-full border border-white/20 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-white/70 transition hover:border-white/40 hover:text-white"
                  data-copy-target="terminal-numbers"
                  type="button"
                >
                  Copy
                </button>
              </div>
              <pre class="overflow-x-auto px-4 py-4 text-xs text-white"><code id="terminal-numbers">curl -G http://localhost:3000/api/todos \\
  --data-urlencode "count=10..25"</code></pre>
            </div>
            <p class="mt-2 text-xs text-black/50">Ranges require both ends.</p>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Dates</p>
            <pre class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code># query
created_at=2025-01-10
created_at=2025-01-10T08:30:00Z
run_at=14:30:00</code></pre>
            <div
              class="mt-3 rounded-2xl border border-black/10 shadow-inner"
              data-terminal="true"
              style="background-color: var(--pine); color: var(--mist);"
            >
              <div class="flex items-center justify-between border-b border-white/10 px-4 py-2 text-[10px] uppercase tracking-[0.3em] text-white/70">
                <span>Terminal</span>
                <button
                  class="rounded-full border border-white/20 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-white/70 transition hover:border-white/40 hover:text-white"
                  data-copy-target="terminal-dates"
                  type="button"
                >
                  Copy
                </button>
              </div>
              <pre class="overflow-x-auto px-4 py-4 text-xs text-white"><code id="terminal-dates">curl -G http://localhost:3000/api/todos \\
  --data-urlencode "created_at=2025-01-10"</code></pre>
            </div>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Other types</p>
            <pre class="mt-4 overflow-x-auto rounded-2xl bg-[color:var(--mist)] p-4 text-xs text-[color:var(--pine)]"><code># query
active=true
id=550e8400-e29b-41d4-a716-446655440000
meta={"tier":"pro"}</code></pre>
          </div>
          <div class="rounded-2xl border border-black/10 bg-white/90 p-4 text-xs text-black/70">
            <p class="font-semibold text-[color:var(--pine)]">Filter modes</p>
            <pre class="mt-3 overflow-x-auto rounded-xl bg-[color:var(--mist)] p-3 text-xs text-[color:var(--pine)]"><code>// src/services/your_service.rs
fn list_filter_mode() -> FilterMode {
    FilterMode::Allowlist(...)
    // or
    FilterMode::AllColumns { deny: &["internal"], parse: ByColumnType }
}</code></pre>
            <p class="mt-2 text-black/50">Unknown columns return 400. Non-string filters reject wildcards.</p>
          </div>
        </section>

        <section id="cli" class="fade-2 mx-auto mt-14 max-w-3xl space-y-4">
          <p class="inline-flex items-center gap-2 text-lg font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] sm:text-xl">
            <span class="h-2.5 w-2.5 rounded-full bg-[color:var(--clay)]"></span>
            CLI
          </p>
          <h2 class="font-display text-2xl leading-tight text-[color:var(--pine)] sm:text-3xl">Scaffold projects and APIs fast.</h2>
          <p class="text-sm text-black/70">
            The companion CLI is named <span class="font-semibold">oxide</span>. Install it once, then initialize
            a fresh project and add or remove CRUD APIs from your project root.
          </p>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Install the CLI</p>
            <div
              class="mt-4 rounded-2xl border border-black/10 shadow-inner"
              data-terminal="true"
              style="background-color: var(--pine); color: var(--mist);"
            >
              <div class="flex items-center justify-between border-b border-white/10 px-4 py-2 text-[10px] uppercase tracking-[0.3em] text-white/70">
                <span>Terminal</span>
                <button
                  class="rounded-full border border-white/20 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-white/70 transition hover:border-white/40 hover:text-white"
                  data-copy-target="terminal-cli-install"
                  type="button"
                >
                  Copy
                </button>
              </div>
              <pre class="overflow-x-auto px-4 py-4 text-xs text-white"><code id="terminal-cli-install"># with Rust installed (crates.io)
cargo install rust-oxide-cli

# no Rust required (macOS/Linux)
curl -fsSL https://raw.githubusercontent.com/HarrisDePerceptron/Rust-Oxide/master/scripts/install.sh | sh</code></pre>
            </div>
            <div
              class="mt-3 rounded-2xl border border-black/10 shadow-inner"
              data-terminal="true"
              style="background-color: var(--pine); color: var(--mist);"
            >
              <div class="flex items-center justify-between border-b border-white/10 px-4 py-2 text-[10px] uppercase tracking-[0.3em] text-white/70">
                <span>Terminal</span>
                <button
                  class="rounded-full border border-white/20 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-white/70 transition hover:border-white/40 hover:text-white"
                  data-copy-target="terminal-cli-update"
                  type="button"
                >
                  Copy
                </button>
              </div>
              <pre class="overflow-x-auto px-4 py-4 text-xs text-white"><code id="terminal-cli-update"># update to the latest version
curl -fsSL https://raw.githubusercontent.com/HarrisDePerceptron/Rust-Oxide/master/scripts/install.sh | sh -s -- --update

# uninstall
curl -fsSL https://raw.githubusercontent.com/HarrisDePerceptron/Rust-Oxide/master/scripts/install.sh | sh -s -- --uninstall</code></pre>
            </div>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Init a new project</p>
            <div
              class="mt-4 rounded-2xl border border-black/10 shadow-inner"
              data-terminal="true"
              style="background-color: var(--pine); color: var(--mist);"
            >
              <div class="flex items-center justify-between border-b border-white/10 px-4 py-2 text-[10px] uppercase tracking-[0.3em] text-white/70">
                <span>Terminal</span>
                <button
                  class="rounded-full border border-white/20 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-white/70 transition hover:border-white/40 hover:text-white"
                  data-copy-target="terminal-cli-init"
                  type="button"
                >
                  Copy
                </button>
              </div>
              <pre class="overflow-x-auto px-4 py-4 text-xs text-white"><code id="terminal-cli-init"># installed via cargo or installer
oxide init my_app

# from this repo
cargo run -p rust-oxide-cli -- init my_app</code></pre>
            </div>
            <p class="mt-2 text-xs text-black/50">
              Add <span class="font-semibold">--non-interactive</span> or
              <span class="font-semibold">--force</span> when you want to skip prompts.
            </p>
          </div>
          <div class="rounded-3xl border border-black/10 bg-white/95 p-6 shadow-xl shadow-black/5">
            <p class="text-xs uppercase tracking-[0.3em] text-black/50">Add or remove an API</p>
            <p class="mt-2 text-sm text-black/60">
              Run these commands from your project root (the directory with <span class="font-semibold">Cargo.toml</span>).
            </p>
            <div
              class="mt-4 rounded-2xl border border-black/10 shadow-inner"
              data-terminal="true"
              style="background-color: var(--pine); color: var(--mist);"
            >
              <div class="flex items-center justify-between border-b border-white/10 px-4 py-2 text-[10px] uppercase tracking-[0.3em] text-white/70">
                <span>Terminal</span>
                <button
                  class="rounded-full border border-white/20 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-white/70 transition hover:border-white/40 hover:text-white"
                  data-copy-target="terminal-cli-api"
                  type="button"
                >
                  Copy
                </button>
              </div>
              <pre class="overflow-x-auto px-4 py-4 text-xs text-white"><code id="terminal-cli-api"># add a CRUD API
oxide api add todo_item --fields "title:string,done:bool"

# remove a CRUD API
oxide api remove todo_item

# preview changes
oxide api add todo_item --dry-run</code></pre>
            </div>
            <p class="mt-2 text-xs text-black/50">
              Use <span class="font-semibold">--no-auth</span> to skip auth middleware and
              <span class="font-semibold">--force</span> to overwrite or prune when needed.
              For local dev, prefix with <span class="font-semibold">cargo run -p rust-oxide-cli --</span>.
            </p>
            <p class="mt-2 text-xs text-black/50">Run <span class="font-semibold">oxide --help</span> for full flags.</p>
          </div>
        </section>

      </main>

      <script>
        (() => {
          const copyWithClipboard = async (text) => {
            if (!navigator.clipboard || !navigator.clipboard.writeText) {
              return false;
            }
            try {
              await navigator.clipboard.writeText(text);
              return true;
            } catch {
              return false;
            }
          };

          const copyWithFallback = (text) => {
            const input = document.createElement("textarea");
            input.value = text;
            input.setAttribute("readonly", "true");
            input.style.position = "absolute";
            input.style.left = "-9999px";
            document.body.appendChild(input);
            input.select();
            let ok = false;
            try {
              ok = document.execCommand("copy");
            } catch {
              ok = false;
            }
            document.body.removeChild(input);
            return ok;
          };

          const showCopied = (button) => {
            const original = button.textContent;
            button.textContent = "Copied";
            button.disabled = true;
            setTimeout(() => {
              button.textContent = original;
              button.disabled = false;
            }, 1200);
          };

          const attachCopyHandler = (button, getText) => {
            button.addEventListener("click", async () => {
              const text = getText().trim();
              if (!text) {
                return;
              }
              const copied =
                (await copyWithClipboard(text)) || copyWithFallback(text);
              if (copied) {
                showCopied(button);
              }
            });
          };

          const terminalButtons = document.querySelectorAll("[data-copy-target]");
          terminalButtons.forEach((button) => {
            const targetId = button.dataset.copyTarget;
            const target = targetId ? document.getElementById(targetId) : null;
            if (!target) {
              return;
            }
            attachCopyHandler(button, () => target.textContent);
          });

          const codeBlocks = document.querySelectorAll("pre > code");
          codeBlocks.forEach((code) => {
            const pre = code.parentElement;
            if (!pre || pre.closest("[data-terminal]")) {
              return;
            }
            if (pre.querySelector("[data-copy-inline]")) {
              return;
            }
            pre.classList.add("relative");
            pre.style.paddingTop = "2.5rem";

            const button = document.createElement("button");
            button.type = "button";
            button.textContent = "Copy";
            button.dataset.copyInline = "true";
            button.className =
              "absolute right-3 top-3 rounded-full border border-black/10 bg-white/80 px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-[color:var(--pine)] shadow-sm transition hover:-translate-y-0.5";
            pre.appendChild(button);
            attachCopyHandler(button, () => code.textContent);
          });
        })();
      </script>
{% endblock %}
